<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guest Page</title>
  <link rel="icon" href="/images/binar-logos-text.png" sizes="128x128" type="image/gif/png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
  <link rel="stylesheet" href="/style/guest.css">
</head>
<body>
  <div class="container-fluid">
    <!-- navbar -->
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color:rgb(255, 167, 52)">
      
      <a class="navbar-brand" href="/homepage">
        <img src="/images/binar-logos-notext.png" width="30" height="30" class="d-inline-block align-top" alt="Logo">
        NodeJS
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
        
        </ul>

        <form class="form-inline my-2 my-lg-0">
          <button class="btn btn-outline-dark btnRegister my-2 my-sm-0" type="button">Register</button>
        </form>

      </div>
    </nav>      
    <!-- navbar -->

    <!-- row alert -->
    <div class="alert alert-primary alert-dismissible show my-3" role="alert">
      This is a primary alertâ€”check it out!
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>      
    </div>
    <!-- row alert -->

    <!-- start navigation -->
    <div class="wrapper-navigation my-3">
      <form class="form-inline justify-content-end">
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroupPrepend">??</span>
          </div>
          <input type="text" class="form-control search mr-2" id="search" name="search" placeholder="Search Here.." style="width:25%;">
        </div>            
        <button type="button" name="btnSearch" id="btnSearch" class="btn btn-md btn-outline-success mr-2">
          <i class="fa fa-search"></i>
        </button>              
        <button type="button" name="btnReset" id="btnReset" class="btn btn-md btn-outline-secondary mr-2">
          <i class="fa fa-broom"></i>
        </button>               
        <button type="button" name="btnRefresh" id="btnRefresh" class="btn btn-md btn-outline-info">
          <i class="fa fa-sync"></i>
        </button>
      </form>
    </div>
    <!-- end navigation -->    

    <!-- row table-product -->
    <div class="wrapper-table-product table-responsive my-3">
        <table class="table table-bordered table-hover table-light">
          <caption class="caption">
            <div class="wrapper-caption d-flex">
              <p class="text-muted col-md-2 m-0 p-0 ">List of All Products</p>
              <ul class="pagination pagination-md col-md-10 m-0 p-0 justify-content-end">
                <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">Next</a></li>
              </ul>              
            </div>
          </caption>          

          <thead class="thead-light">
            <tr>
              <th scope="col" class="text-center" style="width: 5%;">#</th>
              <th scope="col" class="text-center" style="width: 10%;">Name</th>
              <th scope="col" class="text-center" style="width: 10%;">Price</th>
              <th scope="col" class="text-center">Description</th>
              <th scope="col" class="text-center" style="width: 10%;">Owner</th>
              <th scope="col" class="text-center" style="width: 10%;">Stock</th>
              <th scope="col" class="text-center" style="width: 10%;">Action</th>
            </tr>            
          </thead>
          <tbody class="table-body">
                                       
          </tbody>
        </table>      
    </div>
    <!-- row table-product -->    
  </div>
</body>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
<script src="https://pro.fontawesome.com/releases/v5.10.0/js/all.js" integrity="sha384-G/ZR3ntz68JZrH4pfPJyRbjW+c0+ojii5f+GYiYwldYU69A+Ejat6yIfLSxljXxD" crossorigin="anonymous"></script>
<script type="text/javascript">
/* get Cookie */
function getCookies(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for(var i=0;i < ca.length;i++) {
      var c = ca[i];
      while (c.charAt(0)==' ') c = c.substring(1,c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
  }
  return null;
}

/* button REGISTSER di navbar */
document.querySelector('.btnRegister').addEventListener('click', () => {
  location.href = '/homepage';
})

/* button RESET di Navigation */
document.querySelector('#btnReset').addEventListener('click', () => {
  document.querySelector('#search').value = '';
})

/* button REFRESH di Navigation */
document.querySelector('#btnRefresh').addEventListener('click', () => {
  location.href = '/dashboard-guest'
})

/* fetch data to table */
async function getDataTables() {
  const response = await fetch('/list-guest-products', {
    method: 'GET', 
    headers: {
      'Content-Type': 'application/json',
      // 'Owner': JSON.parse(getCookies('user-data')).username,
      // 'Authorization': 'Bearer '+JSON.parse(getCookies('user-data')).token
    }
  })
  // error handling - throw ke catch error
  if (!response.ok) {
    const message = `An error has occured: ${response.status} & Text : ${response.statusText}`;
    throw new Error(message);
  }
  const result = await response.json();

  return result;
}

getDataTables().then(result => {
  for( let i=0; i < result.result.length; i++ ) {
    document.querySelector('.table-body').innerHTML += `
      <tr>
          <td scope="col" class="text-center">${ i+1 }</td>
          <td scope="col" class="text-center"><i>${ result.result[i].name }</i></td>
          <td scope="col" class="text-center">${ Number(result.result[i].price).toLocaleString('id-ID') }</td>
          <td scope="col" class="text-center"><i>${ result.result[i].desc }</i></td>
          <td scope="col" class="text-center">${ result.result[i].owner }</td>
          ${ result.result[i].quantity > 0 ? `<td scope="col" class="text-center"><span class="badge badge-pill badge-success">Available</span></td>` : `<td scope="col" class="text-center"><span class="badge badge-pill badge-danger">Out of Stock</span></td>` }
          <td scope="col" class="text-center"><button type="button" name="btnDetail" id="btnDetail" class="btn btn-sm btn-outline-primary"><i class="fa fa-images"></i></button></td>
      </tr>   
    `;
  }
}).catch(error => {
  console.log(error);
})

/* search and pop data into tables */
document.querySelector('#btnSearch').addEventListener('click', (event) => {
  if( document.querySelector('#search').value == '' || document.querySelector('#search').value == null ) {
    alert('Masukkan Keyword Pencarian');
  } else {
    fetch('/search-data/'+document.querySelector('#search').value, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Owner': JSON.parse(getCookies('user-data')).username,        
      }      
    }).then(response => {
      return response.json()
    }).then(result => {
      console.log(result)
      document.querySelector('.table-body').innerHTML = '';
      for( let i=0; i < result.result.length; i++ ) {
        document.querySelector('.table-body').innerHTML += `
          <tr>
              <td scope="col" class="text-center">${ i+1 }</td>
              <td scope="col" class="text-center"><i>${ result.result[i].name }</i></td>
              <td scope="col" class="text-center">${ Number(result.result[i].price).toLocaleString('id-ID') }</td>
              <td scope="col" class="text-center"><i>${ result.result[i].desc }</i></td>
              <td scope="col" class="text-center">${ result.result[i].owner }</td>
              ${ result.result[i].quantity > 0 ? `<td scope="col" class="text-center"><span class="badge badge-pill badge-success">Available</span></td>` : `<td scope="col" class="text-center"><span class="badge badge-pill badge-danger">Out of Stock</span></td>` }
              <td scope="col" class="text-center"><button type="button" name="btnDetail" id="btnDetail" class="btn btn-sm btn-outline-primary"><i class="fa fa-images"></i></button></td>
          </tr> 
        `;
      }
    }).catch(error => {
      console.log(error)
    })
  }
})

</script>
</html>